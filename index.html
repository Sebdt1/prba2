<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario de Mantenimiento</title>
  <style>
    h1 {
      font-size: 3vh;
    }

    body {
      font-family: Arial, sans-serif;
      margin: 2%;
    }

    .input-container {
      margin-top: 2%;
    }

    label {
      display: block;
      font-size: 2vh;
    }

    select, input[type="text"], textarea {
      width: 96%;
      padding: 1vw;
      display: block;
      margin-top: 1.2vw;
      margin-bottom: 2.4vw;
      font-size: 2vh;
      border: 1px solid #ccc;
      border-radius: 0.6vw;
      box-shadow: 0 0 0.6vw rgba(0, 0, 0, 0.1);
    }

    textarea {
      resize: vertical;
    }

    select {
      appearance: none;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="%23333%"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
      background-repeat: no-repeat;
      background-position: right 1.2vw center;
      padding-right: 3vw;
    }

    button {
      padding: 1vh 2vh;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 0.6vh;
      cursor: pointer;
      font-size: 1.5vh;
      margin-top: 2vh;
    }

    button:hover {
      background-color: #0056b3;
    }

    #canvas-container {
      width: 96%;
      height: 300px; /* Ajustamos la altura del contenedor */
      border: 1px solid #ccc;
      border-radius: 0.6vw;
      box-shadow: 0 0 0.6vw rgba(0, 0, 0, 0.1);
      position: relative;
      margin-top: 2vw;
    }

    canvas {
      width: 100%; /* Ajustamos el ancho del canvas */
      height: 100%; /* Ajustamos la altura del canvas */
      border-radius: 0.6vw;
    }

    #fecha-hora {
      position: absolute;
      bottom: 0.5vw;
      right: 0.5vw;
      font-size: 1vh;
    }
  </style>
</head>
<body>
  <h1>Formulario de Mantenimiento</h1>
  <div class="input-container">
    <label for="numero-solicitud">Número de Solicitud:</label>
    <input type="text" id="numero-solicitud" name="numero-solicitud">
  </div>
  <div class="input-container">
    <label for="serie-equipo">Serie del Equipo:</label>
    <input type="text" id="serie-equipo" name="serie-equipo">
  </div>
  <div class="input-container">
    <label for="tipo-mantenimiento">Tipo de Mantenimiento:</label>
    <select id="tipo-mantenimiento" name="tipo-mantenimiento">
      <option value="Seleccionar" selected>Seleccionar</option>
      <option value="Preventivo">Preventivo</option>
      <option value="Correctivo">Correctivo</option>
    </select>
  </div>
  <div class="input-container" id="descripcion-container" style="display: none;">
    <label for="descripcion">Descripción:</label>
    <textarea id="descripcion" name="descripcion" rows="4"></textarea>
  </div>
  <div class="input-container" id="especificaciones-container" style="display: none;">
    <label for="especificaciones">Especificaciones del Servicio:</label>
    <textarea id="especificaciones" name="especificaciones" rows="4"></textarea>
  </div>
  <div class="input-container" id="materiales-container" style="display: none;">
    <label for="materiales">Materiales y Repuestos:</label>
    <textarea id="materiales" name="materiales" rows="4"></textarea>
  </div>
  <div class="input-container" id="observaciones-container" style="display: none;">
    <label for="observaciones">Observaciones:</label>
    <textarea id="observaciones" name="observaciones" rows="4"></textarea>
  </div>
  <div class="input-container">
    <label for="trabajo-realizado">Trabajo Realizado por:</label>
    <select id="trabajo-realizado-nombre" name="trabajo-realizado-nombre">
      <option value="Seleccionar" selected>Seleccionar</option>
      <option value="SEBASTIAN DIAZ">SEBASTIAN DIAZ</option>
      <option value="DIEGO REYES">DIEGO REYES</option>
      <option value="BRAYAN MORA">BRAYAN MORA</option>
      <option value="CARMEN RAMIREZ">CARMEN RAMIREZ</option>
      <option value="VALENTINA BELTRAN">VALENTINA BELTRAN</option>
      <option value="ANGELICA FORERO">ANGELICA FORERO</option>
    </select>
  </div>
  <div class="input-container">
    <label for="trabajo-recibido">Recibido por:</label>
    <input type="text" id="trabajo-recibido-nombre" name="trabajo-recibido-nombre" placeholder="Nombre">
    <input type="text" id="trabajo-recibido-cargo" name="trabajo-recibido-cargo" placeholder="Cargo">
    <div id="canvas-container">
      <canvas id="trabajo-recibido-dibujo"></canvas>
      <div id="fecha-hora">Fecha: <span id="fecha-hora-valor"></span></div>
    </div>
  </div>
  <button onclick="enviarFormulario()">Siguiente</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/1.5.3/signature_pad.min.js"></script>
  <script>
    var canvas = document.getElementById('trabajo-recibido-dibujo');
    var signaturePad = new SignaturePad(canvas, {
      backgroundColor: 'rgb(255, 255, 255)',
      penColor: 'rgb(0, 0, 0)',
      minWidth: 1,
      maxWidth: 2
    });

    function obtenerFechaHoraActual() {
      var fechaHoraActual = new Date();
      var fecha = fechaHoraActual.toLocaleDateString();
      var hora = fechaHoraActual.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true });
      return fecha + ' ' + hora;
    }

    document.getElementById('fecha-hora-valor').innerText = obtenerFechaHoraActual();

    // Función para enviar el formulario
    function enviarFormulario() {
      // Recopilar todos los datos del formulario
      var numeroSolicitud = document.getElementById('numero-solicitud').value;
      var serieEquipo = document.getElementById('serie-equipo').value;
      var tipoMantenimiento = document.getElementById('tipo-mantenimiento').value;
      var descripcion = document.getElementById('descripcion').value;
      var especificaciones = document.getElementById('especificaciones').value;
      var materiales = document.getElementById('materiales').value;
      var observaciones = document.getElementById('observaciones').value;

      // Obtener la imagen del canvas como base64
      var dataURL = canvas.toDataURL(); // Esto convierte el contenido del canvas en una imagen base64

      // Obtener la fecha y hora actual
      var fechaActual = obtenerFechaHoraActual();

      // Crear el objeto de datos a enviar
      var formData = {
        numeroSolicitud: numeroSolicitud,
        serieEquipo: serieEquipo,
        tipoMantenimiento: tipoMantenimiento,
        descripcion: descripcion,
        especificaciones: especificaciones,
        materiales: materiales,
        observaciones: observaciones,
        imagen: dataURL, // Agregar la imagen del canvas como una propiedad del objeto
        fecha: fechaActual // Agregar la fecha actual al objeto
      };

      // Realizar una solicitud POST al Script de Google Apps
      fetch('https://script.google.com/macros/s/AKfycbxTopc7gMQFfVtBA5CWjw6AxGhN05gPNSxWk7oDON1XyGV6-88pHMwPTUu9mzi1z0p0RQ/exec', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(formData)
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Hubo un problema al enviar el formulario.');
        }
        return response.json();
      })
      .then(data => {
        console.log('Respuesta del servidor:', data);
      })
      .catch(error => {
        console.error('Error:', error);
      });
    }

    window.addEventListener('resize', function() {
      var canvasContainer = document.getElementById('canvas-container');
      var width = canvasContainer.offsetWidth;
      var height = canvasContainer.offsetHeight;
      canvas.width = width;
      canvas.height = height;
      signaturePad.clear();
    });
  </script>
</body>
</html>




